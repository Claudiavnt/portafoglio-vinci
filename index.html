<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login </title>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body class="align">
  <div class="grid align__item">
    <div class="register">
      <img  class="site__logo" src="svg/login.svg" alt=""/>
      <h2>Ciao!</h2>
      <p>Inserisci il codice segreto per vedere i tuoi risparmi</p>
      <form id="passwordForm">
        <div class="form__field">
          <input type="password" maxlength="1" id="input1" oninput="moveToNext(1)" onkeypress="return isNumberKey(event)" placeholder="___">
          <input type="password" maxlength="1" id="input2" oninput="moveToNext(2)" onkeypress="return isNumberKey(event)" disabled placeholder="___">
          <input type="password" maxlength="1" id="input3" oninput="moveToNext(3)" onkeypress="return isNumberKey(event)" disabled placeholder="___">
          <input type="password" maxlength="1" id="input4" oninput="moveToNext(4)" onkeypress="return isNumberKey(event)" disabled placeholder="___">
        </div>
        <div class="form__field">
          <input type="button" onclick="checkPassword()" value="ENTRA">
        </div>
      </form>
      <!-- Modale personalizzata -->
      <div id="myModal" class="modal">
        <div class="modal-content">
            <p id="modalMessage"></p>
            <button class="close-btn" onclick="closeModal()">Chiudi</button>
        </div>
    </div>

    <script>
      const correctPassword = "0312";

      // Abilita solo cifre
      function isNumberKey(evt) {
        const c = evt.which || evt.keyCode;
        if (c < 48 || c > 57) {
          evt.preventDefault();
          return false;
        }
        return true;
      }

      // Sposta avanti automatico
      function moveToNext(idx) {
        const curr = document.getElementById('input'+idx);
        if (curr.value.length === 1 && idx < 4) {
          const next = document.getElementById('input'+(idx+1));
          next.disabled = false;
          next.focus();
        }
      }

      // Gestione backspace “sequenziale”
      function handleBackspace(evt, idx) {
        if (evt.key === 'Backspace') {
          const curr = document.getElementById('input'+idx);
          // Se è già vuoto, torno indietro
          if (curr.value === '') {
            if (idx > 1) {
              curr.disabled = true;            // disabilito il corrente
              const prev = document.getElementById('input'+(idx-1));
              prev.value = '';                  // svuoto il precedente
              prev.disabled = false;            // riabilito il precedente
              prev.focus();                     // ci vado col focus
            }
          } else {
            // se non è vuoto, prima cancello il carattere
            curr.value = '';
          }
          evt.preventDefault();
        }
      }

      // Controlla la password e gestisce la modale
      function checkPassword() {
        const p = Array.from({length:4},(_,i)=>
          document.getElementById('input'+(i+1)).value
        ).join('');
        if (p === correctPassword) {
          window.location.href = "investimento.html";
        } else {
          showModal("Password errata. Riprova!");
          resetInputs();
        }
      }

      function resetInputs() {
        for (let i = 1; i <= 4; i++) {
          const el = document.getElementById('input'+i);
          el.value = '';
          el.disabled = (i !== 1);
        }
        document.getElementById('input1').focus();
      }

      function showModal(msg) {
        document.getElementById('modalMessage').textContent = msg;
        document.getElementById('myModal').style.display = 'flex';
      }
      function closeModal() {
        document.getElementById('myModal').style.display = 'none';
      }

      // Al caricamento, attacco gli handler dinamicamente
      window.addEventListener('DOMContentLoaded', () => {
        resetInputs();
        for (let i = 1; i <= 4; i++) {
          const el = document.getElementById('input'+i);
          el.addEventListener('keypress', isNumberKey);
          el.addEventListener('input', () => moveToNext(i));
          el.addEventListener('keydown', (e) => handleBackspace(e, i));
        }
      });
    </script>

    </div>
  </div>
</body>
</html>